## 函数

### 函数基础

#### 形参和实参

- 形参和实参的类型必须保持一致
- 但是没有规定实参的求值顺序

#### 局部对象

##### 自动对象
局部变量随着函数的控制路径经过变量的创建语句时创建，函数到达定义所在的块末尾时销毁它，称这种对象为**自动对象**。形参是一种自动变量；局部变量也是一种自动变量。

##### 局部静态对象
贯穿函数调用以及其之后的局部变量为局部静态对象，在函数的执行路径第一次创建时**初始化**，直到程序终止时才完成，即使对象所在的函数执行完成对其也没有影响。如果局部静态变量没有经过**显式初始化**，则执行默认初始化。

#### 函数声明

函数只可以被定义一次，但是可以被声明一次。

#### 分离式编译

### 参数传递

形参的类型决定了形参和实参的交互方式。如果形参是引用类型，它将绑定到对应的实参上，否则，将实参的值拷贝给形参。

#### 传值参数

##### 指针形参
可以使用指针的形参访问函数外部的对象，在C++中建议使用引用代替。

#### 传引用参数
改变引用就是改变实例对象，对于某些不支持拷贝操作时，函数只能通过引用形参访问该类型的对象
- 当参数无需修改时最好将其设置为常量引用类型
- 使用引用作为参数可以返回值使用

#### const形参和实参

- **实参初始化形参的时候会忽略掉顶层const**,当形参有顶层const时，传给他常量对象和非常量对象
- 函数重载时忽略掉顶层const

##### 指针或者引用形参参与const
- 可以使用非常量来初始化一个底层const对象
- 一个普通的对象必须使用同一个类型的对象初始化
- 尽量使用常量引用，使用普通引用而不是常量引用会极大的限制住函数所能接受的实参类型，不能把**const对象、字面值或者需要类型转换的对象传给普通的引用形参**

#### 数组形参

数组的特殊性质：
- 不允许拷贝数组
- 数组通常会被转成指针

以下三种函数声明等价：
```
void print(const int*);
void print(const int[]);
void print(const int[10]);
```

##### 注意
以数组作为形参的函数也必须确保使用数组时不会越界

##### 管理指针形参的三种方式
- 使用标记指定数组长度
要求数组本身包含一种结束标记，例如C字符串中的空格
- 使用标准库规范
传递指向数组首元素和尾后元素的指针
- 显示传递一个表示数组大小的形参

##### 数组形参和const
关于引用的讨论适用于指针，当不需要对数组的形参执行写操作的时候，数组的形参应该指向const指针；只有当函数确实需要改变元素值的时候，才能把形参定义成指向非常量的指针。

##### 数组引用形参
```
void print(int (&arr)[10]) {
    for (auto elem : arr) {
        cout << elem << endl;
    }
}
```
`&arr`两端的括号必不可少，否则声明成引用的数组。

##### 传递多维数组
```
void print(int (*matrix)[10], int rowSize);
```

###### 注意
- `int *matrix[10]`表示10个指针构成的数组
- `int (*matrix)[10]`表示指向含有10个整数的数组的指针

### 返回类型和return语句

#### 无返回值函数
- 返回void的语句不一定要求有return语句，因为这类函数最后会隐式执行一个return语句
- 可以使用return语句提前退出

#### 有返回值函数
- return的返回类型必须与函数返回类型相同，或者能够隐式转换成函数返回类型

##### 值是如何被返回的
- 返回局部变量时，返回的是这个变量的拷贝，为一个临时变量
- 返回引用类型时，其返回的是const类型的引用，不会发生对象拷贝
- 不要返回局部对象的指针或者引用

##### 引用返回左值
调用一个返回引用的函数得到左值，其他返回类型为右值。可以像使用左值一样来使用函数的调用，特别是返回非常量引用的函数。

##### 列表初始化返回值
C++11规定函数可以返回花括号包围的值的列表。如果函数返回的是内置类型，则花括号包含的列表最多包含一个值，且该值的占用空间大于目标类型的空间；如果函数返回类类型，则由类本身定义初始值如何使用。
```
int test(int a) {
    if (a == 1) {
        return {2};
    } else {
        return {};
    }
}
```
##### 返回数组指针

通过定义指针别名实现返回指针，例如：
```
typedef int arrT[10]; //[10]放在后面
using arrT = int[10];

arrT* func(int i);
```

- 声明一个返回数组指针的函数
形式如下：
```
Type (*function(par_list))[dimension]
```
例如：
`int (*func(int i))[10]`
    按照如下方式理解：
    - `func(int i)`表示一个需要int类型的实参的函数
    - `(*func(int i))`可以对函数的调用结果执行解引用
    - `(*func(int i))[10]`解引用将得到一个大小为10的数组
    - `int (*func(int i))[10]`数组额元素为int类型

- 使用尾置返回类型
C++11中任何函数都可以使用尾置返回类型，对于返回类型比较复杂的函数比较有效。使用一个`->`开始，例如：
```
auto func1(int arr[][3], int n) -> int(*)[3] {
    return &arr[n];
}
```

- 使用decltype
如果知道函数返回类型指向的对象，可以使用decltype声明：
```
int odd[] = {1, 3, 5, 7, 9};
int even[] = {0, 2, 4, 6, 8};
decltype(odd) *arrPtr(int i ) {//需要加一个*转化成指针
    return (i % 2)? &odd, &even;
}
```
